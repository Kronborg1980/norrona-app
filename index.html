<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"><title>Norröna Onboard Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>:root{--smyril-blue:#002B5C;--smyril-accent:#00A9E0;--background-dark:#011832;--glass-bg:rgba(0, 25, 53, 0.6);--text-light:#ffffff;--text-muted:rgba(255, 255, 255, 0.6);--border-radius:16px}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background-color:var(--background-dark);color:var(--text-light);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#app-shell{max-width:500px;margin:0 auto;background-color:var(--background-dark);min-height:100vh;display:flex;flex-direction:column;padding-bottom:70px}.main-header{position:sticky;top:0;z-index:1000;background:var(--glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,0.1)}.navbar{display:flex;justify-content:space-between;align-items:center;height:60px;padding:0 20px}.navbar .logo img{height:24px}.onboard-time{font-weight:600;font-size:.9rem}main{flex-grow:1}.page{padding:20px;display:none}.page.active{display:block}.section-header{margin-bottom:20px;text-align:center}.section-header h2{font-size:2rem;font-weight:700;color:var(--text-light)}.item-card{background:var(--glass-bg);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);box-shadow:0 8px 30px rgba(0,0,0,.2);overflow:hidden;margin-bottom:20px;opacity:0;transform:translateY(20px);transition:opacity .5s,transform .5s}.item-card.visible{opacity:1;transform:translateY(0)}.image-container{width:100%;height:200px;background:#00152b}.item-card-image{width:100%;height:100%;object-fit:cover;display:block}.item-info{padding:20px}.item-info h3{font-size:1.3rem;font-weight:600}.item-info p{color:var(--text-muted);margin:8px 0;font-size:.9rem}.item-info .fields{border-top:1px solid rgba(255,255,255,.1);margin-top:15px;padding-top:15px;display:grid;gap:8px;font-size:.9rem}.item-info .field{display:flex;justify-content:space-between}.item-info .field strong{color:var(--text-light);font-weight:600}.item-link-button{display:block;background-color:var(--smyril-accent);color:#000;text-align:center;padding:12px;border-radius:8px;text-decoration:none;font-weight:600;margin-top:20px;transition:transform .2s ease}.item-link-button:hover{transform:scale(1.05)}.menu{border-top:1px solid rgba(255,255,255,.1);margin-top:15px;padding-top:15px}.menu h4{font-weight:700;color:var(--smyril-accent);margin-bottom:10px}.menu-item{margin-bottom:10px;font-size:.9rem}.menu-item-header{display:flex;justify-content:space-between;font-weight:600}.menu-item-desc{font-size:.8rem;color:var(--text-muted)}.slideshow{position:relative;width:100%;height:100%;overflow:hidden}.slide{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;transition:opacity .5s ease-in-out}.slide.active{opacity:1}.slide img{width:100%;height:100%;object-fit:cover}#map{width:100%;height:40vh;border-bottom:1px solid rgba(255,255,255,.1)}.leaflet-container{background-color:#1a1a1a}.voyage-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0}.grid-item{background:var(--glass-bg);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);padding:20px;text-align:center}.grid-item .label{font-size:.8rem;color:var(--smyril-accent);margin-bottom:8px;text-transform:uppercase}.grid-item .label.two-line span{display:block}.grid-item .value{font-size:1.5rem;font-weight:700}.grid-item .sub-value{font-size:.8rem;color:var(--text-muted)}.weather-panel{background:var(--glass-bg);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);padding:20px;display:flex;align-items:center;gap:20px}.weather-panel img{width:60px;height:60px}.weather-info .label{font-size:.8rem;color:var(--smyril-accent);text-transform:uppercase}.weather-info .value{font-size:1.2rem;font-weight:700}.home-hero{height:50vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:20px;background-size:cover;background-position:center;position:relative}.home-hero::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(to top,var(--background-dark) 0%,rgba(0,0,0,0.3) 100%)}.home-hero *{position:relative;z-index:2}.home-hero h1{font-size:2.5rem}.home-hero p{font-size:1.1rem;color:var(--text-muted)}.bottom-nav{position:fixed;bottom:0;left:0;right:0;max-width:500px;margin:0 auto;height:70px;background:var(--glass-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid rgba(255,255,255,0.1);display:flex;justify-content:space-around;align-items:center;z-index:1000}.nav-item{display:flex;flex-direction:column;align-items:center;color:var(--text-muted);text-decoration:none;font-size:.7rem;transition:color .2s ease}.nav-item.active{color:var(--smyril-accent)}.nav-item .material-icons{font-size:24px;margin-bottom:2px}</style>
</head>
<body>
    <div id="app-shell">
        <header class="main-header">
            <nav class="navbar">
                <a href="#" class="logo"><img id="header-logo" src="" alt="Logo" loading="lazy"></a>
                <div class="onboard-time" id="onboard-time-header">--:--</div>
            </nav>
        </header>
        <main id="content-container"></main>
    </div>
    <nav class="bottom-nav" id="bottom-nav"></nav>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>const appDataCache={};let map;const destinationMap={hirtshals:{name:"Hirtshals",country:"Denmark",lat:57.594,lon:9.965},torshavn:{name:"Tórshavn",country:"Faroe Islands",lat:62.01,lon:-6.771},seydisfjordur:{name:"Seyðisfjörður",country:"Iceland",lat:65.262,lon:-14.012}};function normalizeDestinationName(name){return name.toLowerCase().replace(/[^a-z]/g,"")}function formatETA(etaString){const eta=new Date(etaString),day=eta.toLocaleDateString("en-GB",{weekday:"long"}),time=eta.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return{day,time}}function haversineDistance(lat1,lon1,lat2,lon2){const R=6371,dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c}const destIcon=L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function updateHeaderTime(){document.getElementById("onboard-time-header").textContent=new Date().toLocaleTimeString("en-GB",{timeZone:"Atlantic/Faroe",hour:"2-digit",minute:"2-digit"})}async function init(){updateHeaderTime();try{const response=await fetch("data.json?v="+Date.now()),data=await response.json();appDataCache.categories=data.categories;appDataCache.settings=data.settings;document.getElementById("header-logo").src=appDataCache.settings.logoUrl;renderBottomNav(appDataCache.categories);renderPages(appDataCache.categories);navigateToPage(appDataCache.categories[0].id);updateShipData(!0)}catch(e){console.error("Failed to load app data",e)}}function renderBottomNav(categories){const bottomNav=document.getElementById("bottom-nav");bottomNav.innerHTML=categories.map(cat=>`<a href="#" class="nav-item" data-page="${cat.id}"><span class="material-icons">${cat.icon}</span>${cat.title}</a>`).join("");bottomNav.addEventListener("click",e=>{const target=e.target.closest(".nav-item");if(target){e.preventDefault();navigateToPage(target.dataset.page)}})}function renderPages(categories){const contentContainer=document.getElementById("content-container");contentContainer.innerHTML=categories.map(cat=>{let content="";if(cat.type==="home"){content='<div class="home-hero" id="home-hero"><h1>Welcome Aboard</h1><p>Discover all Norröna has to offer</p></div><div class="voyage-grid"><div class="grid-item"><div class="label two-line"><span>Speed</span><span>(Knots)</span></div><div class="value" id="speed-knots-home">-- kn</div><div class="sub-value" id="speed-kmh-home">-- km/h</div></div><div class="grid-item"><div class="label">Destination</div><div class="value" id="destination-home">--</div><div class="sub-value" id="eta-home">--</div></div></div>'}else if(cat.type==="voyage"){content='<div id="map"></div><div class="voyage-grid"><div class="grid-item"><div class="label two-line"><span>Speed</span><span>(Knots)</span></div><div class="value" id="speed-knots">-- kn</div><div class="sub-value" id="speed-kmh">-- km/h</div></div><div class="grid-item"><div class="label two-line"><span>Distance to</span><span>Destination</span></div><div class="value" id="distance">--</div><div class="sub-value" id="distance-unit">Kilometers</div></div></div><div class="grid-item full-width"><div class="label" id="destination-label">Next Destination & ETA</div><div class="value" id="destination-voyage">--</div><div class="sub-value" id="eta-voyage">--</div></div><div class="weather-panel"><img id="weather-icon" src="" alt="Weather Icon" loading="lazy"><div class="weather-info"><div class="label">Weather at Destination</div><div class="value" id="weather-description">--</div><div class="sub-value" id="weather-temp">--°C</div></div></div>'}else{content=cat.items.map(item=>`<div class="item-card"><div class="image-container">${item.images.length>1?`<div class="slideshow">${item.images.map(img=>`<div class="slide"><img src="${img}" alt="" loading="lazy"></div>`).join("")}</div>`:item.images[0]?`<img class="item-card-image" src="${item.images[0]}" alt="${item.name}" loading="lazy">`:""}</div><div class="item-info"><h3>${item.name}</h3><p>${item.description}</p><div class="fields">${item.fields.map(field=>`<div class="field"><strong>${field.label}</strong><span>${field.value}</span></div>`).join("")}</div>${item.link.text?`<a href="${item.link.url}" class="item-link-button">${item.link.text}</a>`:""}</div>${item.menu.length?`<div class="menu"><h4>Menu</h4>${item.menu.map(menuItem=>`<div class="menu-item"><div class="menu-item-header"><span>${menuItem.name}</span><span>${menuItem.price}</span></div><p class="menu-item-desc">${menuItem.description}</p></div>`).join("")}</div>`:""}</div>`).join("")}return`<div class="page ${cat.id}-page" id="${cat.id}-page"><div class="section-header"><h2>${cat.title}</h2></div>${content}</div>`}).join("")}function navigateToPage(pageId){document.querySelectorAll(".page").forEach(page=>page.classList.remove("active"));document.getElementById(`${pageId}-page`).classList.add("active");document.querySelectorAll(".nav-item").forEach(nav=>nav.classList.remove("active"));document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add("active");if(pageId==="home")updateShipData(!0);if(pageId==="voyage")initializeVoyagePage();const items=document.querySelectorAll(".item-card");items.forEach((item,index)=>setTimeout(()=>item.classList.add("visible"),index*100));const slideshows=document.querySelectorAll(".slideshow");slideshows.forEach(slideshow=>{const slides=slideshow.querySelectorAll(".slide");if(slides.length>1){let current=0;slides[current].classList.add("active");setInterval(()=>{slides[current].classList.remove("active");current=(current+1)%slides.length;slides[current].classList.add("active")},3e3)}else if(slides.length)slides[0].classList.add("active")})}async function fetchWeatherData(lat,lon){try{const response=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=your_api_key&units=metric`),data=await response.json();document.getElementById("weather-description").textContent=data.weather[0].main;document.getElementById("weather-temp").textContent=`${Math.round(data.main.temp)}°C`;document.getElementById("weather-icon").src=`http://openweathermap.org/img/w/${data.weather[0].icon}.png`}catch(error){document.getElementById("weather-description").textContent="Unavailable";document.getElementById("weather-temp").textContent="--°C";document.getElementById("weather-icon").src=""}}async function updateShipData(isHomePage=!1){try{const response=await fetch("https://smyrillinewebapi-cec3fkhjh8bbhtd3.northeurope-01.azurewebsites.net/vessel/vessels"),norrona=(await response.json()).find(v=>v.vesselName?.toUpperCase()==="NORRONA");if(!norrona||!norrona.destinationFromAIS)return;const speedKnots=norrona.position?.speed||0,currentDestKey=normalizeDestinationName(norrona.destinationFromAIS.split(",")[0].trim()),currentDestInfo=destinationMap[currentDestKey];if(!currentDestInfo)return;const hasArrived=new Date(norrona.etaFromAIS).getTime()<Date.now(),{day,time}=formatETA(norrona.etaFromAIS);if(isHomePage){document.getElementById("speed-knots-home").textContent=`${speedKnots} kn`;document.getElementById("speed-kmh-home").textContent=`${(speedKnots*1.852).toFixed(1)} km/h`;document.getElementById("destination-home").textContent=currentDestInfo.name;document.getElementById("eta-home").textContent=hasArrived?`Arrived: ${day}, ${time}`:`Arrival: ${day}, ${time}`}else{const page=document.querySelector(".voyage-page");if(!page)return;document.getElementById("speed-knots").textContent=`${speedKnots} kn`;document.getElementById("speed-kmh").textContent=`${(speedKnots*1.852).toFixed(1)} km/h`;const distance=haversineDistance(norrona.position.latitude,norrona.position.longitude,currentDestInfo.lat,currentDestInfo.lon);if(distance<1&&speedKnots<1){document.getElementById("distance").textContent="In Harbour";document.getElementById("distance-unit").textContent="At Destination"}else{document.getElementById("distance").textContent=`${Math.round(distance)}`;document.getElementById("distance-unit").textContent="Kilometers"}document.getElementById("destination-label").textContent=hasArrived?"Arrival Information":"Next Destination & ETA";document.getElementById("destination-voyage").textContent=`${currentDestInfo.name}, ${currentDestInfo.country}`;document.getElementById("eta-voyage").textContent=hasArrived?`Arrived ${day} at ${time}`:`Arriving ${day} at ${time}`;const onboardTimeEl=document.getElementById("onboard-time");if(onboardTimeEl)onboardTimeEl.textContent=new Date().toLocaleTimeString("en-GB",{timeZone:"Atlantic/Faroe",hour:"2-digit",minute:"2-digit"});if(map){const shipPos=[norrona.position.latitude,norrona.position.longitude],destPos=[currentDestInfo.lat,currentDestInfo.lon];if(!map.shipMarker){map.shipMarker=L.marker(shipPos,{icon:destIcon}).addTo(map)}else{map.shipMarker.setLatLng(shipPos)}if(!map.destMarker){map.destMarker=L.marker(destPos,{icon:destIcon}).addTo(map)}else{map.destMarker.setLatLng(destPos)}map.fitBounds(L.latLngBounds(shipPos,destPos),{padding:[50,50]})}}setTimeout(()=>fetchWeatherData(currentDestInfo.lat,currentDestInfo.lon),0)}catch(e){}}function initializeVoyagePage(){if(map){map.remove();map=null}map=L.map("map",{zoomControl:!1,attributionControl:!1,renderer:L.canvas()});L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd"}).addTo(map);const routeCoordinates=[[57.594,9.965],[59.5,2],[62.01,-6.771],[65.262,-14.012],[62.01,-6.771]];L.polyline(routeCoordinates,{color:"#00A9E0",weight:2,dashArray:"5, 10",opacity:.7}).addTo(map);updateShipData()}setInterval(updateShipData,12e4);setInterval(updateHeaderTime,1e3);init()</script>
</body>
</html>
