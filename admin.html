<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Norröna CMS</title>
    <script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>body{font-family:'Poppins',sans-serif;background-color:#f3f4f6}.input-field{width:100%;padding:.75rem;border:1px solid #d1d5db;border-radius:.5rem;transition:border-color .2s,box-shadow .2s}.input-field:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.4)}.label{display:block;font-weight:600;color:#374151;margin-bottom:.5rem}.hidden{display:none}</style>
</head>
<body>
    <header class="bg-gray-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><h1 class="text-2xl font-bold">Norröna Content Management</h1></div>
    </header>
    <main id="app" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md"><p class="font-bold">Workflow:</p><p>Manage your site content below. When finished, click the green button to download the `data.json` file, then upload it to your GitHub repository.</p></div>
        <section><h2 class="text-3xl font-bold text-gray-900 border-b pb-4 mb-6">General Settings</h2><div class="bg-white p-6 rounded-lg shadow-md"><div><label class="label">Header Logo Image</label><div class="flex items-center gap-4"><img id="logo-preview" class="h-10 border p-1 rounded-md bg-gray-800"><input type="file" class="input-field" id="logo-url-input" accept="image/*"></div></div></div></section>
        <section><h2 class="text-3xl font-bold text-gray-900 border-b pb-4 mb-6">Menu Categories</h2><div id="categories-container" class="space-y-6"></div><button id="add-category" class="mt-6 w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition"><span class="material-icons">add</span>Add New Menu Category</button></section>
    </main>
    <div class="sticky bottom-0 bg-white/80 backdrop-blur-sm p-4 border-t shadow-inner">
        <div class="max-w-7xl mx-auto"><button id="generate-json" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg text-lg flex items-center justify-center gap-3"><span class="material-icons">download</span>Generate & Download data.json</button></div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        let appData = { settings: { logoUrl: '' }, categories: [] };
        const categoriesContainer = document.getElementById("categories-container");
        const logoUrlInput = document.getElementById("logo-url-input");
        const logoPreview = document.getElementById("logo-preview");

        function render() {
            logoPreview.src = appData.settings.logoUrl;
            categoriesContainer.innerHTML = appData.categories.map((cat, catIndex) => `
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                        <input type="text" class="text-xl font-bold text-gray-800 bg-transparent w-full" value="${cat.title}" placeholder="Category Title (e.g., Outlets)" data-cat-index="${catIndex}" data-key="title">
                        <button class="remove-category text-red-500 hover:text-red-700 ml-4" data-cat-index="${catIndex}"><span class="material-icons">delete_forever</span></button>
                    </div>
                    <div class="p-6 space-y-4" id="items-container-${catIndex}">
                        ${cat.items.map((item, itemIndex) => `
                            <div class="border rounded-md p-4 bg-gray-50">
                                <div class="flex justify-between items-center mb-4">
                                    <input type="text" class="text-lg font-semibold bg-transparent w-full" value="${item.name}" placeholder="Item Name" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="name">
                                    <button class="remove-item text-red-500 hover:text-red-700 ml-2" data-cat-index="${catIndex}" data-item-index="${itemIndex}"><span class="material-icons">delete</span></button>
                                </div>
                                <div class="space-y-4">
                                    <div><label class="label text-sm">Description</label><textarea class="input-field text-sm" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="description">${item.description}</textarea></div>
                                    <div><label class="label text-sm">Image</label><div class="flex items-center gap-4"><img src="${item.image}" class="h-16 w-16 object-cover border p-1 rounded-md"><input type="file" class="input-field" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="image" accept="image/*"></div></div>
                                    <div><h4 class="label text-sm">Custom Fields (e.g., Deck, Time, Opening Hours)</h4><div class="space-y-2">
                                        ${item.fields.map((field, fieldIndex) => `
                                            <div class="flex items-center gap-2">
                                                <input type="text" class="input-field text-sm" placeholder="Label (e.g., Deck)" value="${field.label}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}" data-key="label">
                                                <input type="text" class="input-field text-sm" placeholder="Value (e.g., 6)" value="${field.value}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}" data-key="value">
                                                <button class="remove-field text-red-500" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}"><span class="material-icons text-base">remove_circle</span></button>
                                            </div>
                                        `).join('')}
                                    </div><button class="add-field mt-2 text-xs font-semibold text-blue-600" data-cat-index="${catIndex}" data-item-index="${itemIndex}">+ Add Field</button></div>
                                </div>
                            </div>`).join('')}
                        <button class="add-item mt-4 w-full text-blue-600 font-semibold py-2 rounded-md hover:bg-blue-50" data-cat-index="${catIndex}">+ Add New Item to ${cat.title}</button>
                    </div>
                </div>`).join('');
        }
        
        fetch("data.json?v=" + Date.now()).then(res => res.json()).then(data => { appData = data; render(); }).catch(err => { console.error("Could not load data.json. Starting with a blank template.", err); render(); });

        const appContainer = document.getElementById('app');
        appContainer.addEventListener('input', e => {
            const target = e.target;
            if (target.matches('input, textarea')) {
                const catIndex = target.dataset.catIndex;
                const itemIndex = target.dataset.itemIndex;
                const fieldIndex = target.dataset.fieldIndex;
                const key = target.dataset.key;
                if (catIndex === undefined) return;
                
                if (itemIndex === undefined) {
                    appData.categories[catIndex][key] = target.value;
                } else if (fieldIndex === undefined) {
                    appData.categories[catIndex].items[itemIndex][key] = target.value;
                } else {
                    appData.categories[catIndex].items[itemIndex].fields[fieldIndex][key] = target.value;
                }
            }
        });

        appContainer.addEventListener('change', e => {
            if (e.target.matches('input[type="file"]')) {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const base64String = event.target.result;
                    const catIndex = e.target.dataset.catIndex;
                    const itemIndex = e.target.dataset.itemIndex;
                    if (catIndex === undefined) {
                        appData.settings.logoUrl = base64String;
                        document.getElementById("logo-preview").src = base64String;
                    } else {
                        appData.categories[catIndex].items[itemIndex].image = base64String;
                        e.target.previousElementSibling.src = base64String;
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        appContainer.addEventListener('click', e => {
            const target = e.target.closest('button'); if (!target) return;
            const catIndex = target.dataset.catIndex;
            const itemIndex = target.dataset.itemIndex;
            const fieldIndex = target.dataset.fieldIndex;

            if (target.matches('#add-category')) {
                const newId = `category-${Date.now()}`;
                appData.categories.push({ id: newId, title: 'New Category', items: [] });
            } else if (target.matches('.remove-category')) {
                if (confirm('Are you sure you want to delete this entire category and all its items?')) appData.categories.splice(catIndex, 1);
            } else if (target.matches('.add-item')) {
                appData.categories[catIndex].items.push({ id: `item-${Date.now()}`, name: 'New Item', description: '', image: 'https://placehold.co/800x400/eee/ccc?text=Upload+Image', fields: [] });
            } else if (target.matches('.remove-item')) {
                appData.categories[catIndex].items.splice(itemIndex, 1);
            } else if (target.matches('.add-field')) {
                appData.categories[catIndex].items[itemIndex].fields.push({ label: '', value: '' });
            } else if (target.matches('.remove-field')) {
                appData.categories[catIndex].items[itemIndex].fields.splice(fieldIndex, 1);
            }
            render();
        });
        
        document.getElementById('generate-json').addEventListener('click', () => { const jsonString = JSON.stringify(appData, null, 2); const blob = new Blob([jsonString], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'data.json'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); });
    });
    </script>
</body>
</html>
