<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Norröna CMS</title>
    <script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>body{font-family:'Poppins',sans-serif;background-color:#f3f4f6}.input-field{width:100%;padding:.75rem;border:1px solid #d1d5db;border-radius:.5rem;transition:border-color .2s,box-shadow .2s}.input-field:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.4)}.label{display:block;font-weight:600;color:#374151;margin-bottom:.5rem}.hidden{display:none}</style>
</head>
<body>
    <header class="bg-gray-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><h1 class="text-2xl font-bold">Norröna Content Management</h1></div>
    </header>
    <main id="app" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md"><p class="font-bold">Workflow:</p><p>Manage your site content below. When finished, click the green button to download the `data.json` file, then upload it to your GitHub repository.</p></div>
        <section><h2 class="text-3xl font-bold text-gray-900 border-b pb-4 mb-6">General Settings</h2><div class="bg-white p-6 rounded-lg shadow-md"><div><label class="label">Header Logo Image</label><div class="flex items-center gap-4"><img id="logo-preview" class="h-10 border p-1 rounded-md bg-gray-800"><input type="file" class="input-field" id="logo-url-input" accept="image/*"></div></div></div></section>
        <section><h2 class="text-3xl font-bold text-gray-900 border-b pb-4 mb-6">Menu Categories</h2><div id="categories-container" class="space-y-6"></div><button id="add-category" class="mt-6 w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition"><span class="material-icons">add</span>Add New Menu Category</button></section>
    </main>
    <div class="sticky bottom-0 bg-white/80 backdrop-blur-sm p-4 border-t shadow-inner">
        <div class="max-w-7xl mx-auto"><button id="generate-json" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg text-lg flex items-center justify-center gap-3"><span class="material-icons">download</span>Generate & Download data.json</button></div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        let appData = { settings: { logoUrl: '' }, categories: [] };
        
        function render() {
            document.getElementById("logo-preview").src = appData.settings.logoUrl;
            document.getElementById("categories-container").innerHTML = appData.categories.map((cat, catIndex) => `
                <div class="bg-white rounded-lg shadow-md">
                    <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                        <input type="text" class="text-xl font-bold text-gray-800 bg-transparent w-full" value="${cat.title}" placeholder="Category Title" data-cat-index="${catIndex}" data-key="title">
                        <select class="input-field text-sm w-48" data-cat-index="${catIndex}" data-key="type"><option value="grid" ${cat.type==='grid'?'selected':''}>Grid Layout</option><option value="voyage" ${cat.type==='voyage'?'selected':''}>Voyage Map Layout</option></select>
                        <button class="remove-category text-red-500 hover:text-red-700 ml-4" data-cat-index="${catIndex}"><span class="material-icons">delete_forever</span></button>
                    </div>
                    <div class="p-6 space-y-4">
                        ${cat.items.map((item, itemIndex) => `<div class="border rounded-md p-4 bg-gray-50"><div class="flex justify-between items-center mb-4"><input type="text" class="text-lg font-semibold bg-transparent w-full" value="${item.name}" placeholder="Item Name" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="name"><button class="remove-item text-red-500 hover:text-red-700 ml-2" data-cat-index="${catIndex}" data-item-index="${itemIndex}"><span class="material-icons">delete</span></button></div><div class="space-y-4">
                        <div><label class="label text-sm">Description</label><textarea class="input-field text-sm" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="description">${item.description}</textarea></div>
                        <div><label class="label text-sm">Images</label><input type="file" class="input-field" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="images" accept="image/*" multiple><div class="flex flex-wrap gap-2 mt-2">${(Array.isArray(item.images)?item.images:[]).map((img,imgIndex)=>`<div class="relative"><img src="${img}" class="h-16 w-16 object-cover border rounded-md"><button class="remove-image absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-img-index="${imgIndex}"><span class="material-icons text-base">close</span></button></div>`).join('')}</div></div>
                        <div><h4 class="label text-sm">Link Button (Optional)</h4><div class="grid grid-cols-2 gap-2"><input type="text" class="input-field text-sm" placeholder="Link Text (e.g., View Catalogue)" value="${item.link?.text || ''}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="linkText"><input type="text" class="input-field text-sm" placeholder="Full URL (https://...)" value="${item.link?.url || ''}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-key="linkUrl"></div></div>
                        <div><h4 class="label text-sm">Custom Fields</h4><div class="space-y-2">${item.fields.map((field,fieldIndex)=>`<div class="flex items-center gap-2"><input type="text" class="input-field text-sm" placeholder="Label" value="${field.label}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}" data-key="label"><input type="text" class="input-field text-sm" placeholder="Value" value="${field.value}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}" data-key="value"><button class="remove-field text-red-500" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-field-index="${fieldIndex}"><span class="material-icons text-base">remove_circle</span></button></div>`).join('')}</div><button class="add-field mt-2 text-xs font-semibold text-blue-600" data-cat-index="${catIndex}" data-item-index="${itemIndex}">+ Add Field</button></div>
                        <div><h4 class="label text-sm">Menu</h4><div class="space-y-2">${(item.menu||[]).map((menuItem,menuIndex)=>`<div class="grid grid-cols-3 gap-2 border-t pt-2"><input type="text" class="input-field text-sm col-span-2" placeholder="Item Name" value="${menuItem.name}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-menu-index="${menuIndex}" data-key="name"><div class="flex items-center gap-2"><input type="text" class="input-field text-sm" placeholder="Price" value="${menuItem.price}" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-menu-index="${menuIndex}" data-key="price"><button class="remove-menu-item text-red-500" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-menu-index="${menuIndex}"><span class="material-icons text-base">remove_circle</span></button></div><textarea class="input-field text-sm col-span-3 mt-1" placeholder="Description" data-cat-index="${catIndex}" data-item-index="${itemIndex}" data-menu-index="${menuIndex}" data-key="description">${menuItem.description}</textarea></div>`).join('')}</div><button class="add-menu-item mt-2 text-xs font-semibold text-blue-600" data-cat-index="${catIndex}" data-item-index="${itemIndex}">+ Add Menu Item</button></div>
                        </div></div>`).join('')}<button class="add-item mt-4 w-full text-blue-600 font-semibold py-2 rounded-md hover:bg-blue-50" data-cat-index="${catIndex}">+ Add New Item to ${cat.title}</button></div></div>`).join('');
        }
        fetch("data.json?v=" + Date.now()).then(res => res.json()).then(data => { appData = data; render(); }).catch(err => { console.error("Could not load data.json.", err); render(); });
        const appContainer = document.getElementById('app');
        appContainer.addEventListener('input', e => { const target = e.target; if (target.matches('input, textarea, select')) { const { catIndex, itemIndex, fieldIndex, menuIndex, key } = target.dataset; if (catIndex === undefined) return; const value = target.value; const item = appData.categories[catIndex].items[itemIndex]; if (itemIndex === undefined) { appData.categories[catIndex][key] = value; } else if (key === 'linkText' || key === 'linkUrl') { if (!item.link) item.link = {text:'', url:''}; item.link[key === 'linkText' ? 'text':'url'] = value; } else if (menuIndex !== undefined) { item.menu[menuIndex][key] = value; } else if (fieldIndex === undefined) { item[key] = value; } else { item.fields[fieldIndex][key] = value; } } });
        appContainer.addEventListener('change', e => { if (e.target.matches('input[type="file"]')) { const files = e.target.files; if (!files.length) return; const { catIndex, itemIndex } = e.target.dataset; if (catIndex === undefined) { const reader = new FileReader(); reader.onload = (event) => { appData.settings.logoUrl = event.target.result; render(); }; reader.readAsDataURL(files[0]); } else { const item = appData.categories[catIndex].items[itemIndex]; if(!Array.isArray(item.images)) item.images = []; Array.from(files).forEach(file => { const reader = new FileReader(); reader.onload = (event) => { item.images.push(event.target.result); render(); }; reader.readAsDataURL(file); }); } } });
        appContainer.addEventListener('click', e => { const target = e.target.closest('button'); if (!target) return; const { catIndex, itemIndex, fieldIndex, menuIndex, imgIndex } = target.dataset; if (target.matches('#add-category')) { appData.categories.push({ id: `category-${Date.now()}`, title: 'New Category', type: 'grid', items: [] }); } else if (target.matches('.remove-category')) { if (confirm('Are you sure?')) appData.categories.splice(catIndex, 1); } else if (target.matches('.add-item')) { appData.categories[catIndex].items.push({ id: `item-${Date.now()}`, name: 'New Item', description: '', images: [], fields: [], menu: [] }); } else if (target.matches('.remove-item')) { appData.categories[catIndex].items.splice(itemIndex, 1); } else if (target.matches('.add-field')) { appData.categories[catIndex].items[itemIndex].fields.push({ label: '', value: '' }); } else if (target.matches('.remove-field')) { appData.categories[catIndex].items[itemIndex].fields.splice(fieldIndex, 1); } else if (target.matches('.remove-image')) { appData.categories[catIndex].items[itemIndex].images.splice(imgIndex, 1); } else if (target.matches('.add-menu-item')) { if (!appData.categories[catIndex].items[itemIndex].menu) appData.categories[catIndex].items[itemIndex].menu = []; appData.categories[catIndex].items[itemIndex].menu.push({ name: '', description: '', price: '' }); } else if (target.matches('.remove-menu-item')) appData.categories[catIndex].items[itemIndex].menu.splice(menuIndex, 1); render(); });
        document.getElementById('generate-json').addEventListener('click', () => { const jsonString = JSON.stringify(appData, null, 2); const blob = new Blob([jsonString], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'data.json'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); });
    });
    </script>
</body>
</html>
